# Replication

태그: 데이터베이스

# Replication이란?

> **📌** 리플리케이션이란, 여러개의 DB를 권한에 따라 수직적인 구조 (Master-Slave)로 구축하는 방식
> 
> - 리플리케이션에서 Master Node는 쓰기 작업만을 처리하며 Slave Node는 읽기 작업만을 처리함
> 
> → **`비동기 방식`**으로 노드들간의 데이터를 동기화함
> 

## **📌** 리플리케이션 처리 방식

![MySQL의 Replication방식에 대한 그림](Replication%2051ff215b7ebf408e9bfb57ec22d62ae3/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-07-16_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB_2.59.04.png)

MySQL의 Replication방식에 대한 그림

1. Master 노드에 쓰기 트랜잭션이 수행됨
2. Master 노드는 데이터를 저장, 트랜잭션에 대한 로그를 파일에 기록함 ( BIN LOG)
3. Slave 노드의 IO Thread는 Master 노드의 로그파일 (BIN LOG)를 파일(Replay Log)에 복사함
4. Slave 노드의 SQL Thread는 파일(Replay Log)를 한줄씩 읽으며 데이터를 저장

⇒ Master와 Slave간의 데이터 무결성 검사(데이터가 일치하는지)를 하지않는 비동기방식으로 데이터를 동기화함

- 이러한 구조에 의한 장단점이 존재함 !

### **✔ 리플리케이션 (Replication) 장점과 단점**

- 장점
    - DB 요청의 60~80%정도가 읽기 작업이므로 Replication만 해도 충분히 성능을 높일 수 있음
    - 비동기 방식으로 운영되어 지연 시간이 거의 없음
- 단점
    - 노드들간의 데이터 동기화가 보장되지않아, 일관성있는 데이터를 얻지 못할 수 있음
    - Master노드가 다운되면 복구 및 대처가 까다로움

**📌✔**

# 클러스터링(Clustering)이란?

> **📌  클러스팅이란 여러 개의 DB를 수평적인 구조로 구축하는 방식**
> 
> 
> 분산 환경을 구성하여 Single point of failure와 같은 문제를 해결할 수 있는 Fail Over 시스템을 구축하기 위해서 사용됨
> 
> ⇒ **`동기 방식`**으로 노드들 간의 데이터를 동기화함
> 

## **📌 클러스터링** 처리 방식

![MySQL의 Clustering 방식 中 Galera 방식](Replication%2051ff215b7ebf408e9bfb57ec22d62ae3/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-07-16_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB_3.04.25.png)

MySQL의 Clustering 방식 中 Galera 방식

1. 1개의 노드에 쓰기 트랜잭션이 수행되고, COMMIT을 실행함
2. 실제 디스크에 내용을 쓰기 전에 다른 노드로 데이터의 복제를 요청함
3. 다른 노드에서 복제 요청을 수락했다는 신호(OK)를 보내고, 디스크에 쓰기를 시작함
4. 다른 노드에서 신호(OK)를 받으면 실제 디스크에 데이터를 저장함

⇒ DB들 간의 데이터 무결성 검사 (데이터가 일치하는지)를 하는 동기방식으로 데이터를 동기화함.

- 이러한 구조에 의한 장단점이 존재함 !

### **✔ 클러스터링 ( Clustering ) 장점과 단점**

- 장점
    - 노드들 간의 데이터를 동기화하여 항상 일관성있는 데이터를 얻을 수 있음
    - 1개의 노드가 죽어도 다른 노드가 살아있어 시스템을 장애없이 계속 운영할 수 있음
- 단점
    - 여러 노드들간의 데이터를 동기화하는 시간이 필요하므로 Replication에 비해 쓰기 성능이 떨어짐
    - 장애가 전파된 경우 처리가 까다로우며, 데이터 동기화에 의해 스케일링에 한계가 있음
    
    <aside>
    💡 클러스터링을 구현하는 방법으론 또 Active-Active // Active-Standby가 있음
    
    1. Active-Active는 클러스터를 항상 가동하여 가용가능한 상태로 두는 구성 방식
    2. Active-Standby는 일부 클러스터는 가동하고 일부 클러스터는 대기상태로 구성하는 방식
    
    상황에 따라 알맞는 구조를 선택하자~
    
    </aside>
    

🔗 [https://mangkyu.tistory.com/97](https://mangkyu.tistory.com/97)