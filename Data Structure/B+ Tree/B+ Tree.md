# B+ Tree

태그: 자료구조

> B-Tree, B+Tree의 차이점을 서술하시오~
> 

# #B-Tree / B+Tree / B*Tree

- 탐색 자료 구조

## 0. 이진트리

![스크린샷 2023-07-27 오후 1.50.06.png](B+%20Tree%20f922b1c7d1b74f3eb6231c9d40602fd0/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-07-27_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.50.06.png)

> 각각의 노드가 최대 두개의 자식노드를 가지는 트리 자료구조
> 
> 
> = B trees : 이진트리에서 발전되어 모든 리프노드들이 같은 레벨을 가질 수 있도록 자동으로 밸런스를 맞추는 균형이진트리의 확장판!
> 

### **📌 이진트리 종류**

- 정이진 트리 Full binary tree
    - 트리의 모든 node가 0개 혹은 2개의 자식을 가지는경우
- 포화 이진 트리 Perfect binary tree
    - leaf node가 끝까지 꽉 찬 트리
- 완전 이진 트리 Complete binary tree
    - 마지막 레벨을 제외한 모든 레벨에서 순서대로 node가 꽉 채워진 트리를 의미
- 균형 이진 트리 Balanced binary tree
    - leaf node들의 레벨 차이가 최대 1레벨 까지만 나는 트리

⇒ 즉 균형이 깨질 경우 별도의 로직을 통해 다시 균형을 유지하게 됨을 의미함

![스크린샷 2023-07-27 오후 1.52.52.png](B+%20Tree%20f922b1c7d1b74f3eb6231c9d40602fd0/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-07-27_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_1.52.52.png)

<aside>
💡 **균형 이진 트리를 많이 사용하는 이유는?**

한 쪽으로 쏠릴 수 있는 어지러운 현실세계에서도 트리의 높이를 균형적으로 유지시켜줄 수 있음

- 검색할때 최악의 경우 O(logN)의 안정성을 유지하기때문
- 예시) AVL트리, 레드블랙트리, B-Tree 종류 등 이용
</aside>

# 1. B-Tree

![스크린샷 2023-07-27 오후 2.12.42.png](B+%20Tree%20f922b1c7d1b74f3eb6231c9d40602fd0/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-07-27_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.12.42.png)

> 이진 트리와는 다르게 하나의 노드에 많은 정보를 가지거나, 두 개 이상의 자식을 가질 수 있음
> 
- 최대 M개의 자식을 가질 수 있는 B-Tree를 M차 B-Tree라고 부름 (차수)
    - 정해진 범위 만큼의 키가 하나의 노드에 포함될 수 있게 됨
- 하나의 노드에 여러 자료를 배치하게 되면서 , 이진트리보다 훨씬 많은 데이터를 더 효울적으로 저장소에 담을 수 있게 됨
    - ✏️ **`예시`** 하드디스크나 SSD와 같은 외부 기억 장치 : “ 블럭 단위로 파일 입출력”
        - 파일 크기와 상관없이 동일함  - 블럭 단위로 처리
        - 입출력에 있어서는 1KB짜리 블럭에 1byte짜리 알파벳 하나가 들어가있어도 1KB 꽉 차있는 블럭과 차이가 없음!
        - 이때 하나의 블럭에 여러 데이터를 동시에 저장할 수 있다면? → B-Tree
- 균형 이진트리의 연속 - 균형이 유지됨
    - 최악의 경우라고 해도 O(logN) 검색 성능 보임

### **📌  B-Tree 수학적 특징**

- 각 노드의 자료는 정렬되어있음
- 자료 중복 X
- 모든 leaf node는 같은 레벨에 있음
- root node는 자신이 leaf node가 되지않는 이상 적어도 2개 이상의 자식을 가짐
- root node와 leaf node를 제외한 노드들은 최대 M개부터 최소 [M/2]개까지의 자식을 가질 수 있음
- 노드의 키는 **최대 M-1개부터 최소[M/2]-1개**의 키가 포함될 수 있음
- 자식 수의 하한값을 T라고 하면 M=2t-1을 만족함

<aside>
💡 **B-Tree의 단점**

- 균형 구조를 유지 하기 위해서 추가적인 연산이 수행되거나 새로운 노드가 생성됨
- **노드의 추가적인 생성과 추가적인 연산의 최소화**를 위해 B-Tree에서 몇가지 규칙이 추가된 `B* Tree`가 등장
- **탐색을 위해서 노드를 찾아서 이동**해야함! → `B+ Tree` 등장
</aside>

# 2. B*Tree

- 기존 노드의 자식 노드 수 최소 제약 조건이 2M/3개로 늘어났고, 노드가 가득 차면 분열 대신 이웃한 형제 노드로 재배치하게 됨
    - 재배치 할 수 없는 시점에서 분열함

### **📌  B*Tree 수학적 특징**

- 각 노드의 자료는 정렬되어있음
- 자료는 중복X
- 모든 Leaf node는 같은 레벨에 있음
- root node는 자신이 leaf node가 되지 않는 이상 적어도 2개 이상의 자식을 가짐
- root node가 아닌 노드들은 적어도 **2[(M-2)/3]+1 개**의 자식 노드를 가지고 있음 (최대 M개)

---

# 3. B+Tree

> 같은 레벨의 모든 키 값들이 정렬되어있고, 같은 레벨의 Sibling node는 연결리스트 형태로 이어져있음
> 
> - 같은 레벨의 Sibling node는 모두 연결되어있어 키 값이 중복되지 않음
> - 만약 특정 값을 찾아야하는 상황이라면 leaf node에 모든 자료들이 존재하고, 그 자료들이 연결리스트로 연결되어있으므로 **탐색**에 매우 유리함!
>     
>     ![스크린샷 2023-07-27 오후 2.21.45.png](B+%20Tree%20f922b1c7d1b74f3eb6231c9d40602fd0/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-07-27_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.21.45.png)
>     

![스크린샷 2023-07-27 오후 2.26.29.png](B+%20Tree%20f922b1c7d1b74f3eb6231c9d40602fd0/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-07-27_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.26.29.png)

![스크린샷 2023-07-27 오후 2.32.58.png](B+%20Tree%20f922b1c7d1b74f3eb6231c9d40602fd0/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-07-27_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.32.58.png)

### **✔ B+Tree Structure**

- leaf node가 아닌 자료는 **`인덱스 노드!`**
    - 인덱스 노드의 Value값에는 다음 노드를 가리킬 수 있는 포인터 주소가 존재함
- leaf node 자료는 **`데이터 노드!`**
    - 데이터 노드의 Value값에 데이터가 존재함
    

⇒ 키 값은 중복될 수 있으며, ( 인덱스노드, 데이터 노드에서 동시에 등장 가능함)

⇒ 데이터 검색을 위해선 반드시 Leaf node까지 내려가야한다는 특징이 존재함

![스크린샷 2023-07-27 오후 2.25.05.png](B+%20Tree%20f922b1c7d1b74f3eb6231c9d40602fd0/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-07-27_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.25.05.png)

- 같은 레벨 노드끼리 Double Linked List를 사용
- 자식 노드는 Single Linked List 사용함
- key의 범위마다 찾아가야할 페이지 넘버(포인터)가 있는데, 해당 페이지 넘버를 통해 곧바로 다음 노드로 넘어감
- 리프 노드에 다다랐을때 디스크에 존재하는 데이터의 주소 값을 구할 수 있고 Linked List를 통해 탐색도 가능함

<aside>
💡 데이터 베이스에서 가장 중요한 것은 **“ 검색 속도 “**

대부분의 데이터베이스 시스템은 B+Tree 구조 채택함

</aside>

**📌  B+Tree 수학적 특징**

- 데이터 노드의 자료는 정렬되어있음
- 데이터 노드에서는 데이터가 중복되지 않음
- 모든 leaf node는 같은 레벨에 존재
- leaf node가 아닌 node의 키 값의 수는 그 노드의 서브트리수보다 하나가 적음
- 모든 leaf node는 연결리스트로 연결되어있음

<aside>
✏️ **`B+ Tree의 장점`**

1. 리프 노드를 제외하고 데이터를 담아두지 않으므로 , 메모리를 더 확보함으로써 더 많은 key들을 수용할 수 있음
    - 하나의 노드에 더 많은 key를 담을 수 있으니 , 트리의 높이는 더 낮아짐 ( cache hit를 높임 )
2. 풀 스캔시, B+ Tree는 리프 노드에 데이터가 모두 있으므로 , 한번의 선형 탐색만 하면 되므로 빠름 ↔ B-Tree는 모든 노드에 대해서 탐색해야함
</aside>

---

### ✏️ B-tree Vs B+tree

아래서 말하는 데이터는 자료구조 상 value를 가리킴. (실제 DB 데이터 X)

| 구분 | B-tree | B+tree |
| --- | --- | --- |
| 데이터 저장 | 리프 노드, 브랜치 노드 모두 데이터 저장 가능 | 오직 리프 노드에만 데이터 저장 가능 |
| 트리의 높이 | 높음 | 낮음(한 노드 당 key를 많이 담을 수 있음) |
| 풀 스캔 시, 검색 속도 | 모든 노드 탐색 | 리프 노드에서 선형 탐색 |
| 키 중복 | 없음 | 있음(리프 노드에 모든 데이터가 있기 때문) |
| 검색 | 자주 access 되는 노드를 루트 노드 가까이 배치할 수 있고, 루트 노드에서 가까울 경우, 브랜치 노드에도 데이터가 존재하기 때문에 빠름 | 리프 노드까지 가야 데이터 존재 |
| 링크드 리스트 | 없음 | 리프 노드끼리 링크드 리스트로 연결 |
- 데이터 저장 :
    - B-Tree : internal 또는 branch 노드에 key & data를 담을 수 있음
    - B+Tree : branch 노드에 key만 담아두고 , data는 담지 않음
        - 오직 리프 노드에만 key와 data를 저장하고 리프 노드끼리 Linked List로 연결되어있음

🔗 [https://velog.io/@emplam27/자료구조-그림으로-알아보는-B-Plus-Tree](https://velog.io/@emplam27/%EC%9E%90%EB%A3%8C%EA%B5%AC%EC%A1%B0-%EA%B7%B8%EB%A6%BC%EC%9C%BC%EB%A1%9C-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-B-Plus-Tree)

🔗 [https://ssocoit.tistory.com/217](https://ssocoit.tistory.com/217)

[https://zorba91.tistory.com/293](https://zorba91.tistory.com/293)